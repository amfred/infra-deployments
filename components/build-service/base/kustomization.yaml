resources:
- https://github.com/redhat-appstudio/build-service/config/kcp?ref=61ad51e80af24618ed043b6022ea4f4dfac09afd

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

images:
- name: quay.io/redhat-appstudio/build-service
  newName: quay.io/redhat-appstudio/build-service
  newTag: 61ad51e80af24618ed043b6022ea4f4dfac09afd

namespace: build-service

patches:
# Add APIExport flag to the operator arguments list
- patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/args/1
      value: --api-export-name=build-service
  target:
    kind: Deployment
    name: controller-manager
- patch: |-
    - op: replace
      path: /metadata/name
      value: build-service
  target:
    kind: APIExport
    name: build-service-apiexport
# Add App Studio controller label to the namespace for easier log searches
# Add network traffic logging to meet the "monitor outgoing network 
# traffic" ESS requirement
- patch: |-
    - op: add
      path: /metadata/labels/appstudio.redhat.com~1namespacetype
      value:
        "controller"
    - op: add
      path: /metadata/annotations/k8s.ovn.org~1acl-logging
      value:
        '{"deny": "info", "allow": "info"}'
  target:
    kind: Namespace
